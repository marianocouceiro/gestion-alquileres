<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gesti√≥n de Alquileres</title>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&family=Montserrat:wght@700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2b5876;
            --primary-light: #4e89ae;
            --primary-dark: #1a3a4d;
            --accent: #f39c12;
            --accent-bright: #f1c40f;
            --danger: #e74c3c;
            --success: #27ae60;
            --warning: #ff6b6b;
            --bg-main: #f8f9fa;
            --bg-card: #ffffff;
            --text-primary: #2c3e50;
            --text-secondary: #7f8c8d;
            --border: #e0e6ed;
            --shadow: rgba(43, 88, 118, 0.08);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Manrope', sans-serif;
            background: var(--bg-main);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            padding: 2rem 0;
            box-shadow: 0 4px 20px var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .logo h1 {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
            font-weight: 900;
            letter-spacing: -0.5px;
        }

        .header-stats {
            display: flex;
            gap: 2rem;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 800;
            display: block;
        }

        .stat-label {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .alert-banner {
            background: linear-gradient(135deg, var(--warning) 0%, var(--danger) 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 16px;
            margin-bottom: 2rem;
            display: none;
            align-items: center;
            gap: 1rem;
            box-shadow: 0 8px 24px rgba(255, 107, 107, 0.3);
            animation: slideDown 0.5s ease;
        }

        .alert-banner.show {
            display: flex;
        }

        .alert-icon {
            font-size: 2rem;
            animation: pulse 2s infinite;
        }

        .alert-content h3 {
            font-size: 1.2rem;
            margin-bottom: 0.25rem;
        }

        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--border);
            flex-wrap: wrap;
        }

        .tab {
            padding: 1rem 2rem;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            position: relative;
            transition: all 0.3s;
            border-radius: 8px 8px 0 0;
        }

        .tab:hover {
            color: var(--primary);
            background: rgba(43, 88, 118, 0.05);
        }

        .tab.active {
            color: var(--primary);
            background: var(--bg-card);
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--primary);
            border-radius: 3px 3px 0 0;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 20px var(--shadow);
            margin-bottom: 2rem;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border);
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
            font-size: 0.95rem;
        }

        input, select, textarea {
            padding: 0.875rem;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 1rem;
            font-family: 'Manrope', sans-serif;
            transition: all 0.3s;
            background: white;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(43, 88, 118, 0.1);
        }

        .btn {
            padding: 0.875rem 2rem;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Manrope', sans-serif;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(43, 88, 118, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(43, 88, 118, 0.4);
        }

        .btn-secondary {
            background: var(--text-secondary);
            color: white;
        }

        .btn-secondary:hover {
            background: var(--text-primary);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-warning {
            background: var(--accent);
            color: white;
        }

        .table-container {
            overflow-x: auto;
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        thead {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
        }

        th {
            padding: 1.25rem 1rem;
            text-align: left;
            font-weight: 700;
            font-size: 0.95rem;
            letter-spacing: 0.3px;
        }

        td {
            padding: 1.25rem 1rem;
            border-bottom: 1px solid var(--border);
        }

        tbody tr {
            transition: background 0.2s;
        }

        tbody tr:hover {
            background: rgba(43, 88, 118, 0.03);
        }

        tbody tr.urgent {
            background: rgba(255, 107, 107, 0.08);
        }

        tbody tr.expiring {
            background: rgba(243, 156, 18, 0.08);
        }

        .badge {
            display: inline-block;
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .badge-active {
            background: rgba(39, 174, 96, 0.15);
            color: var(--success);
        }

        .badge-urgent {
            background: rgba(255, 107, 107, 0.15);
            color: var(--warning);
        }

        .badge-expiring {
            background: rgba(243, 156, 18, 0.15);
            color: var(--accent);
        }

        .badge-paused {
            background: rgba(127, 140, 141, 0.15);
            color: var(--text-secondary);
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .action-buttons button {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 2.5rem;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .close-btn:hover {
            background: rgba(0, 0, 0, 0.05);
            color: var(--text-primary);
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .empty-state h3 {
            font-size: 1.3rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .empty-state p {
            color: var(--text-secondary);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes modalSlideIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1.5rem;
            }

            .header-stats {
                width: 100%;
                justify-content: space-around;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .tabs {
                overflow-x: auto;
            }

            .tab {
                white-space: nowrap;
            }

            .table-container {
                font-size: 0.9rem;
            }

            th, td {
                padding: 0.75rem 0.5rem;
            }

            .action-buttons {
                flex-direction: column;
            }

            .action-buttons button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">üè†</div>
                <h1>Gesti√≥n de Alquileres</h1>
            </div>
            <div class="header-stats">
                <div class="stat-item">
                    <span class="stat-value" id="headerTotalContracts">0</span>
                    <span class="stat-label">Contratos</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="headerUrgent">0</span>
                    <span class="stat-label">Urgentes</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="headerExpiring">0</span>
                    <span class="stat-label">Por vencer</span>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Alert Banners -->
        <div id="alertUpdateBanner" class="alert-banner">
            <div class="alert-icon">‚ö†Ô∏è</div>
            <div class="alert-content">
                <h3>Actualizaciones Urgentes</h3>
                <p id="alertUpdateText"></p>
            </div>
        </div>

        <div id="alertExpirationBanner" class="alert-banner">
            <div class="alert-icon">üìÖ</div>
            <div class="alert-content">
                <h3>Contratos por Vencer</h3>
                <p id="alertExpirationText"></p>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('dashboard')">üìä Dashboard</button>
            <button class="tab" onclick="switchTab('contracts')">üìã Contratos</button>
            <button class="tab" onclick="switchTab('add')">‚ûï Nuevo Contrato</button>
            <button class="tab" onclick="switchTab('edit')">‚úèÔ∏è Editar Contratos</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboardTab" class="tab-content active">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìä Resumen General</h2>
                    <button class="btn btn-primary" onclick="exportToCSV()">
                        üì• Exportar CSV
                    </button>
                </div>
                <div class="form-grid">
                    <div class="stat-item" style="background: linear-gradient(135deg, var(--primary), var(--primary-light)); color: white; padding: 1.5rem; border-radius: 12px;">
                        <span class="stat-value" id="dashTotalContracts">0</span>
                        <span class="stat-label">Contratos Activos</span>
                    </div>
                    <div class="stat-item" style="background: linear-gradient(135deg, var(--warning), var(--danger)); color: white; padding: 1.5rem; border-radius: 12px;">
                        <span class="stat-value" id="dashUrgent">0</span>
                        <span class="stat-label">Actualizaciones Urgentes</span>
                    </div>
                    <div class="stat-item" style="background: linear-gradient(135deg, var(--accent), var(--accent-bright)); color: white; padding: 1.5rem; border-radius: 12px;">
                        <span class="stat-value" id="dashExpiring">0</span>
                        <span class="stat-label">Contratos por Vencer</span>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üîÑ Pr√≥ximas Actualizaciones (30 d√≠as)</h2>
                </div>
                <div id="upcomingUpdates"></div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìÖ Contratos por Vencer (90 d√≠as)</h2>
                </div>
                <div id="upcomingExpirations"></div>
            </div>
        </div>

        <!-- Contracts Tab -->
        <div id="contractsTab" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìã Todos los Contratos</h2>
                </div>
                <div id="contractsList"></div>
            </div>
        </div>

        <!-- Add Contract Tab -->
        <div id="addTab" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">‚ûï Nuevo Contrato</h2>
                </div>
                <form id="contractForm" onsubmit="addContract(event)">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="address">Direcci√≥n *</label>
                            <input type="text" id="address" required>
                        </div>
                        <div class="form-group">
                            <label for="ownerName">Nombre del Propietario *</label>
                            <input type="text" id="ownerName" required>
                        </div>
                        <div class="form-group">
                            <label for="ownerPhone">Tel√©fono del Propietario *</label>
                            <input type="tel" id="ownerPhone" required>
                        </div>
                        <div class="form-group">
                            <label for="tenantName">Nombre del Inquilino *</label>
                            <input type="text" id="tenantName" required>
                        </div>
                        <div class="form-group">
                            <label for="tenantPhone">Tel√©fono del Inquilino *</label>
                            <input type="tel" id="tenantPhone" required>
                        </div>
                        <div class="form-group">
                            <label for="currentAmount">Monto Actual *</label>
                            <input type="number" id="currentAmount" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="indexType">√çndice de Actualizaci√≥n *</label>
                            <select id="indexType" required>
                                <option value="ICL">ICL (√çndice Ley de Alquileres)</option>
                                <option value="IPC">IPC (√çndice de Precios al Consumidor)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="startDate">Fecha de Inicio *</label>
                            <input type="date" id="startDate" required>
                        </div>
                        <div class="form-group">
                            <label for="duration">Duraci√≥n (meses) *</label>
                            <input type="number" id="duration" min="1" required>
                        </div>
                        <div class="form-group">
                            <label for="updateFrequency">Frecuencia de Actualizaci√≥n *</label>
                            <select id="updateFrequency" required>
                                <option value="3">Cada 3 meses</option>
                                <option value="4">Cada 4 meses</option>
                                <option value="6">Cada 6 meses</option>
                                <option value="12">Anual</option>
                            </select>
                        </div>
                    </div>
                    <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                        <button type="submit" class="btn btn-primary">üíæ Guardar Contrato</button>
                        <button type="button" class="btn btn-secondary" onclick="resetForm()">üîÑ Limpiar</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Edit Contract Tab -->
        <div id="editTab" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">‚úèÔ∏è Editar Contratos</h2>
                </div>
                <div id="editContractsList"></div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Editar Contrato</h3>
                <button class="close-btn" onclick="closeModal('editModal')">‚úï</button>
            </div>
            <form id="editForm" onsubmit="saveEdit(event)">
                <input type="hidden" id="editId">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="editAddress">Direcci√≥n *</label>
                        <input type="text" id="editAddress" required>
                    </div>
                    <div class="form-group">
                        <label for="editOwnerName">Nombre del Propietario *</label>
                        <input type="text" id="editOwnerName" required>
                    </div>
                    <div class="form-group">
                        <label for="editOwnerPhone">Tel√©fono del Propietario *</label>
                        <input type="tel" id="editOwnerPhone" required>
                    </div>
                    <div class="form-group">
                        <label for="editTenantName">Nombre del Inquilino *</label>
                        <input type="text" id="editTenantName" required>
                    </div>
                    <div class="form-group">
                        <label for="editTenantPhone">Tel√©fono del Inquilino *</label>
                        <input type="tel" id="editTenantPhone" required>
                    </div>
                    <div class="form-group">
                        <label for="editCurrentAmount">Monto Actual *</label>
                        <input type="number" id="editCurrentAmount" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="editIndexType">√çndice de Actualizaci√≥n *</label>
                        <select id="editIndexType" required>
                            <option value="ICL">ICL (√çndice Ley de Alquileres)</option>
                            <option value="IPC">IPC (√çndice de Precios al Consumidor)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editStartDate">Fecha de Inicio *</label>
                        <input type="date" id="editStartDate" required>
                    </div>
                    <div class="form-group">
                        <label for="editDuration">Duraci√≥n (meses) *</label>
                        <input type="number" id="editDuration" min="1" required>
                    </div>
                    <div class="form-group">
                        <label for="editUpdateFrequency">Frecuencia de Actualizaci√≥n *</label>
                        <select id="editUpdateFrequency" required>
                            <option value="3">Cada 3 meses</option>
                            <option value="4">Cada 4 meses</option>
                            <option value="6">Cada 6 meses</option>
                            <option value="12">Anual</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editStatus">Estado *</label>
                        <select id="editStatus" required>
                            <option value="active">Activo</option>
                            <option value="paused">Pausado</option>
                            <option value="completed">Finalizado</option>
                        </select>
                    </div>
                </div>
                <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                    <button type="submit" class="btn btn-success">üíæ Guardar Cambios</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('editModal')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Sample Data - Replace with real data
        let contracts = [
            {
                id: 1,
                address: 'Av. C√≥rdoba 1234',
                ownerName: 'Juan P√©rez',
                ownerPhone: '1123456789',
                tenantName: 'Mar√≠a Gonz√°lez',
                tenantPhone: '1198765432',
                currentAmount: 150000,
                indexType: 'ICL',
                startDate: '2024-01-15',
                duration: 24,
                updateFrequency: 4,
                status: 'active'
            },
            {
                id: 2,
                address: 'Av. Santa Fe 5678',
                ownerName: 'Ana Rodr√≠guez',
                ownerPhone: '1145678912',
                tenantName: 'Carlos L√≥pez',
                tenantPhone: '1156789123',
                currentAmount: 200000,
                indexType: 'IPC',
                startDate: '2023-06-01',
                duration: 36,
                updateFrequency: 3,
                status: 'active'
            }
        ];

        let nextId = 3;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            updateDashboard();
            renderAllContracts();
            renderEditContracts();
            checkAlerts();
        });

        // Load data from localStorage
        function loadData() {
            const saved = localStorage.getItem('contracts');
            if (saved) {
                contracts = JSON.parse(saved);
                if (contracts.length > 0) {
                    nextId = Math.max(...contracts.map(c => c.id)) + 1;
                }
            }
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('contracts', JSON.stringify(contracts));
        }

        // Tab Switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            if (tabName === 'contracts') {
                renderAllContracts();
            } else if (tabName === 'edit') {
                renderEditContracts();
            }
        }

        // Add Contract
        function addContract(event) {
            event.preventDefault();
            
            const contract = {
                id: nextId++,
                address: document.getElementById('address').value,
                ownerName: document.getElementById('ownerName').value,
                ownerPhone: document.getElementById('ownerPhone').value,
                tenantName: document.getElementById('tenantName').value,
                tenantPhone: document.getElementById('tenantPhone').value,
                currentAmount: parseFloat(document.getElementById('currentAmount').value),
                indexType: document.getElementById('indexType').value,
                startDate: document.getElementById('startDate').value,
                duration: parseInt(document.getElementById('duration').value),
                updateFrequency: parseInt(document.getElementById('updateFrequency').value),
                status: 'active'
            };
            
            contracts.push(contract);
            saveData();
            
            alert('‚úÖ Contrato agregado exitosamente');
            resetForm();
            updateDashboard();
            checkAlerts();
        }

        // Edit Contract (Open Modal)
        function editContract(id) {
            const contract = contracts.find(c => c.id === id);
            if (!contract) return;
            
            document.getElementById('editId').value = contract.id;
            document.getElementById('editAddress').value = contract.address;
            document.getElementById('editOwnerName').value = contract.ownerName;
            document.getElementById('editOwnerPhone').value = contract.ownerPhone;
            document.getElementById('editTenantName').value = contract.tenantName;
            document.getElementById('editTenantPhone').value = contract.tenantPhone;
            document.getElementById('editCurrentAmount').value = contract.currentAmount;
            document.getElementById('editIndexType').value = contract.indexType;
            document.getElementById('editStartDate').value = contract.startDate;
            document.getElementById('editDuration').value = contract.duration;
            document.getElementById('editUpdateFrequency').value = contract.updateFrequency;
            document.getElementById('editStatus').value = contract.status;
            
            document.getElementById('editModal').classList.add('show');
        }

        // Save Edit
        function saveEdit(event) {
            event.preventDefault();
            
            const id = parseInt(document.getElementById('editId').value);
            const index = contracts.findIndex(c => c.id === id);
            
            if (index !== -1) {
                contracts[index] = {
                    id: id,
                    address: document.getElementById('editAddress').value,
                    ownerName: document.getElementById('editOwnerName').value,
                    ownerPhone: document.getElementById('editOwnerPhone').value,
                    tenantName: document.getElementById('editTenantName').value,
                    tenantPhone: document.getElementById('editTenantPhone').value,
                    currentAmount: parseFloat(document.getElementById('editCurrentAmount').value),
                    indexType: document.getElementById('editIndexType').value,
                    startDate: document.getElementById('editStartDate').value,
                    duration: parseInt(document.getElementById('editDuration').value),
                    updateFrequency: parseInt(document.getElementById('editUpdateFrequency').value),
                    status: document.getElementById('editStatus').value
                };
                
                saveData();
                closeModal('editModal');
                updateDashboard();
                renderAllContracts();
                renderEditContracts();
                checkAlerts();
                alert('‚úÖ Contrato actualizado exitosamente');
            }
        }

        // Delete Contract
        function deleteContract(id) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar este contrato?')) {
                contracts = contracts.filter(c => c.id !== id);
                saveData();
                updateDashboard();
                renderAllContracts();
                renderEditContracts();
                checkAlerts();
                alert('‚úÖ Contrato eliminado');
            }
        }

        // Calculate Next Update Date
        function calculateNextUpdate(contract) {
            const start = new Date(contract.startDate);
            const today = new Date();
            const monthsSinceStart = (today.getFullYear() - start.getFullYear()) * 12 + (today.getMonth() - start.getMonth());
            
            // Calcular cu√°ntos per√≠odos de actualizaci√≥n han pasado
            const periodsPassed = Math.floor(monthsSinceStart / contract.updateFrequency);
            
            // Calcular la pr√≥xima fecha de actualizaci√≥n
            const nextUpdateMonths = (periodsPassed + 1) * contract.updateFrequency;
            const nextUpdate = new Date(start);
            nextUpdate.setMonth(start.getMonth() + nextUpdateMonths);
            
            return nextUpdate;
        }

        // Calculate End Date
        function calculateEndDate(contract) {
            const start = new Date(contract.startDate);
            const end = new Date(start);
            end.setMonth(start.getMonth() + contract.duration);
            return end;
        }

        // Calculate New Amount (simplified - would need real index data)
        function calculateNewAmount(contract) {
            // Simulaci√≥n: incremento del 10% por actualizaci√≥n
            const increment = contract.indexType === 'ICL' ? 1.10 : 1.08;
            return Math.round(contract.currentAmount * increment);
        }

        // Get Days Until
        function getDaysUntil(date) {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const target = new Date(date);
            target.setHours(0, 0, 0, 0);
            const diffTime = target - today;
            return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        }

        // Check if Update is Urgent (10 days or less)
        function isUrgent(date) {
            const days = getDaysUntil(date);
            return days >= 0 && days <= 10;
        }

        // Check if Contract is Expiring (60 days or less)
        function isExpiring(date) {
            const days = getDaysUntil(date);
            return days >= 0 && days <= 60;
        }

        // Format Currency
        function formatCurrency(amount) {
            return new Intl.NumberFormat('es-AR', {
                style: 'currency',
                currency: 'ARS',
                minimumFractionDigits: 0
            }).format(amount);
        }

        // Format Date
        function formatDate(date) {
            if (typeof date === 'string') {
                date = new Date(date);
            }
            return new Intl.DateTimeFormat('es-AR', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            }).format(date);
        }

        // Generate WhatsApp Message
        function generateWhatsAppMessage(id) {
            const contract = contracts.find(c => c.id === id);
            if (!contract) return;
            
            const nextUpdate = calculateNextUpdate(contract);
            const newAmount = calculateNewAmount(contract);
            
            const message = `Hola ${contract.tenantName}, te informo que el ${formatDate(nextUpdate)} se realizar√° la actualizaci√≥n del contrato de alquiler de ${contract.address}. El nuevo monto ser√° de ${formatCurrency(newAmount)}. Saludos!`;
            
            const encodedMessage = encodeURIComponent(message);
            const phoneNumber = contract.tenantPhone.replace(/\D/g, '');
            const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodedMessage}`;
            
            window.open(whatsappUrl, '_blank');
        }

        // Generate Expiration Messages
        function generateExpirationMessages(id) {
            const contract = contracts.find(c => c.id === id);
            if (!contract) return;
            
            const endDate = calculateEndDate(contract);
            
            // Message for Tenant
            const tenantMessage = `Hola ${contract.tenantName}, te informo que el contrato de alquiler de ${contract.address} vence el ${formatDate(endDate)}. Por favor, comunicate para coordinar la renovaci√≥n o finalizaci√≥n. Saludos!`;
            
            // Message for Owner
            const ownerMessage = `Hola ${contract.ownerName}, te informo que el contrato de alquiler de ${contract.address} vence el ${formatDate(endDate)}. Te mantendremos informado sobre la renovaci√≥n o finalizaci√≥n. Saludos!`;
            
            const encodedTenantMsg = encodeURIComponent(tenantMessage);
            const encodedOwnerMsg = encodeURIComponent(ownerMessage);
            
            const tenantPhone = contract.tenantPhone.replace(/\D/g, '');
            const ownerPhone = contract.ownerPhone.replace(/\D/g, '');
            
            const tenantUrl = `https://wa.me/${tenantPhone}?text=${encodedTenantMsg}`;
            const ownerUrl = `https://wa.me/${ownerPhone}?text=${encodedOwnerMsg}`;
            
            if (confirm('¬øEnviar mensaje al inquilino primero?')) {
                window.open(tenantUrl, '_blank');
                setTimeout(() => {
                    if (confirm('¬øEnviar mensaje al propietario ahora?')) {
                        window.open(ownerUrl, '_blank');
                    }
                }, 1000);
            }
        }

        // Render All Contracts
        function renderAllContracts() {
            const container = document.getElementById('contractsList');
            const activeContracts = contracts.filter(c => c.status === 'active');
            
            if (activeContracts.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìã</div>
                        <h3>No hay contratos registrados</h3>
                        <p>Comienza agregando un nuevo contrato</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Direcci√≥n</th>
                                <th>Propietario</th>
                                <th>Inquilino</th>
                                <th>Monto Actual</th>
                                <th>√çndice</th>
                                <th>Pr√≥xima Actualizaci√≥n</th>
                                <th>Fecha Finalizaci√≥n</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${activeContracts.map(contract => {
                                const nextUpdate = calculateNextUpdate(contract);
                                const endDate = calculateEndDate(contract);
                                const daysUntilUpdate = getDaysUntil(nextUpdate);
                                const daysUntilEnd = getDaysUntil(endDate);
                                const isUrgentUpdate = isUrgent(nextUpdate);
                                const isExpiringContract = isExpiring(endDate);
                                
                                return `
                                    <tr class="${isUrgentUpdate ? 'urgent' : (isExpiringContract ? 'expiring' : '')}">
                                        <td><strong>${contract.address}</strong></td>
                                        <td>${contract.ownerName}<br><small>${contract.ownerPhone}</small></td>
                                        <td>${contract.tenantName}<br><small>${contract.tenantPhone}</small></td>
                                        <td><strong>${formatCurrency(contract.currentAmount)}</strong></td>
                                        <td>${contract.indexType}</td>
                                        <td>
                                            ${formatDate(nextUpdate)}
                                            <br>
                                            <span class="badge ${isUrgentUpdate ? 'badge-urgent' : 'badge-active'}">
                                                ${daysUntilUpdate} d√≠as
                                            </span>
                                        </td>
                                        <td>
                                            ${formatDate(endDate)}
                                            <br>
                                            <span class="badge ${isExpiringContract ? 'badge-expiring' : 'badge-active'}">
                                                ${daysUntilEnd} d√≠as
                                            </span>
                                        </td>
                                        <td>
                                            <span class="badge badge-active">Activo</span>
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        // Render Edit Contracts
        function renderEditContracts() {
            const container = document.getElementById('editContractsList');
            
            if (contracts.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìã</div>
                        <h3>No hay contratos para editar</h3>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Direcci√≥n</th>
                                <th>Propietario</th>
                                <th>Inquilino</th>
                                <th>Monto</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${contracts.map(contract => `
                                <tr>
                                    <td><strong>${contract.address}</strong></td>
                                    <td>${contract.ownerName}</td>
                                    <td>${contract.tenantName}</td>
                                    <td>${formatCurrency(contract.currentAmount)}</td>
                                    <td>
                                        <span class="badge badge-${contract.status === 'active' ? 'active' : 'paused'}">
                                            ${contract.status === 'active' ? 'Activo' : contract.status === 'paused' ? 'Pausado' : 'Finalizado'}
                                        </span>
                                    </td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="btn btn-primary" onclick="editContract(${contract.id})">
                                                ‚úèÔ∏è Editar
                                            </button>
                                            <button class="btn btn-danger" onclick="deleteContract(${contract.id})">
                                                üóëÔ∏è Eliminar
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        // Update Dashboard
        function updateDashboard() {
            const activeContracts = contracts.filter(c => c.status === 'active');
            
            let urgentCount = 0;
            let expiringCount = 0;
            
            activeContracts.forEach(contract => {
                const nextUpdate = calculateNextUpdate(contract);
                const endDate = calculateEndDate(contract);
                
                if (isUrgent(nextUpdate)) urgentCount++;
                if (isExpiring(endDate)) expiringCount++;
            });
            
            document.getElementById('headerTotalContracts').textContent = activeContracts.length;
            document.getElementById('headerUrgent').textContent = urgentCount;
            document.getElementById('headerExpiring').textContent = expiringCount;
            
            document.getElementById('dashTotalContracts').textContent = activeContracts.length;
            document.getElementById('dashUrgent').textContent = urgentCount;
            document.getElementById('dashExpiring').textContent = expiringCount;

            renderUpcomingUpdates();
            renderUpcomingExpirations();
        }

        // Render Upcoming Updates
        function renderUpcomingUpdates() {
            const container = document.getElementById('upcomingUpdates');
            const activeContracts = contracts.filter(c => c.status === 'active');
            
            const upcoming = activeContracts
                .map(contract => ({
                    contract,
                    nextUpdate: calculateNextUpdate(contract),
                    daysUntil: getDaysUntil(calculateNextUpdate(contract))
                }))
                .filter(item => item.daysUntil >= 0 && item.daysUntil <= 30)
                .sort((a, b) => a.daysUntil - b.daysUntil);

            if (upcoming.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">‚úÖ</div>
                        <h3>No hay actualizaciones pr√≥ximas</h3>
                        <p>No hay contratos que actualicen en los pr√≥ximos 30 d√≠as</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Direcci√≥n</th>
                                <th>D√≠as restantes</th>
                                <th>Fecha de actualizaci√≥n</th>
                                <th>Fecha fin contrato</th>
                                <th>Monto actual</th>
                                <th>Nuevo monto</th>
                                <th>Acci√≥n</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${upcoming.map(item => {
                                const newAmount = calculateNewAmount(item.contract);
                                const endDate = calculateEndDate(item.contract);
                                const isUrgentUpdate = item.daysUntil <= 10;
                                return `
                                    <tr class="${isUrgentUpdate ? 'urgent' : ''}">
                                        <td><strong>${item.contract.address}</strong></td>
                                        <td>
                                            <span class="badge ${isUrgentUpdate ? 'badge-urgent' : 'badge-active'}">
                                                ${item.daysUntil} d√≠as
                                            </span>
                                        </td>
                                        <td>${formatDate(item.nextUpdate)}</td>
                                        <td>${formatDate(endDate)}</td>
                                        <td>${formatCurrency(item.contract.currentAmount)}</td>
                                        <td><strong>${formatCurrency(newAmount)}</strong></td>
                                        <td>
                                            <button class="btn btn-primary" onclick="generateWhatsAppMessage(${item.contract.id})" style="padding: 0.5rem 1rem; font-size: 0.9rem;">
                                                üí¨ Notificar
                                            </button>
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        // Render Upcoming Expirations
        function renderUpcomingExpirations() {
            const container = document.getElementById('upcomingExpirations');
            const activeContracts = contracts.filter(c => c.status === 'active');
            
            const expiring = activeContracts
                .map(contract => ({
                    contract,
                    endDate: calculateEndDate(contract),
                    daysUntil: getDaysUntil(calculateEndDate(contract))
                }))
                .filter(item => item.daysUntil >= 0 && item.daysUntil <= 90)
                .sort((a, b) => a.daysUntil - b.daysUntil);

            if (expiring.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">‚úÖ</div>
                        <h3>No hay contratos pr√≥ximos a vencer</h3>
                        <p>No hay contratos que finalicen en los pr√≥ximos 90 d√≠as</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Direcci√≥n</th>
                                <th>Propietario</th>
                                <th>Inquilino</th>
                                <th>D√≠as restantes</th>
                                <th>Fecha de finalizaci√≥n</th>
                                <th>Acci√≥n</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${expiring.map(item => {
                                const isExpiringUrgent = item.daysUntil <= 60;
                                return `
                                    <tr class="${isExpiringUrgent ? 'expiring' : ''}">
                                        <td><strong>${item.contract.address}</strong></td>
                                        <td>${item.contract.ownerName}</td>
                                        <td>${item.contract.tenantName}</td>
                                        <td>
                                            <span class="badge ${isExpiringUrgent ? 'badge-expiring' : 'badge-active'}">
                                                ${item.daysUntil} d√≠as
                                            </span>
                                        </td>
                                        <td>${formatDate(item.endDate)}</td>
                                        <td>
                                            <button class="btn btn-warning" onclick="generateExpirationMessages(${item.contract.id})" style="padding: 0.5rem 1rem; font-size: 0.9rem;">
                                                üìÖ Notificar Vencimiento
                                            </button>
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        // Check Alerts
        function checkAlerts() {
            const activeContracts = contracts.filter(c => c.status === 'active');
            
            const urgentUpdates = activeContracts.filter(contract => {
                const nextUpdate = calculateNextUpdate(contract);
                return isUrgent(nextUpdate);
            });

            const expiringContracts = activeContracts.filter(contract => {
                const endDate = calculateEndDate(contract);
                return isExpiring(endDate);
            });

            // Update alerts
            if (urgentUpdates.length > 0) {
                document.getElementById('alertUpdateBanner').classList.add('show');
                document.getElementById('alertUpdateText').textContent = 
                    `Tienes ${urgentUpdates.length} contrato${urgentUpdates.length > 1 ? 's' : ''} que actualiza${urgentUpdates.length > 1 ? 'n' : ''} en los pr√≥ximos 10 d√≠as`;
            }

            // Expiration alerts
            if (expiringContracts.length > 0) {
                document.getElementById('alertExpirationBanner').classList.add('show');
                document.getElementById('alertExpirationText').textContent = 
                    `Tienes ${expiringContracts.length} contrato${expiringContracts.length > 1 ? 's' : ''} que vence${expiringContracts.length > 1 ? 'n' : ''} en los pr√≥ximos 60 d√≠as`;
            }
        }

        // Export to CSV
        function exportToCSV() {
            const activeContracts = contracts.filter(c => c.status === 'active');
            
            let csv = 'Direcci√≥n,Propietario,Tel. Propietario,Inquilino,Tel. Inquilino,Monto Actual,√çndice,Pr√≥xima Actualizaci√≥n,Nuevo Monto,Fecha Finalizaci√≥n,Estado\n';
            
            activeContracts.forEach(contract => {
                const nextUpdate = calculateNextUpdate(contract);
                const newAmount = calculateNewAmount(contract);
                const endDate = calculateEndDate(contract);
                
                csv += `"${contract.address}","${contract.ownerName}","${contract.ownerPhone}","${contract.tenantName}","${contract.tenantPhone}",${contract.currentAmount},"${contract.indexType}","${formatDate(nextUpdate)}",${newAmount},"${formatDate(endDate)}","${contract.status}"\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `contratos_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
        }

        // Reset Form
        function resetForm() {
            document.getElementById('contractForm').reset();
        }

        // Close Modal
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        // Close modal on outside click
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('show');
                }
            });
        });
    </script>
</body>
</html>
